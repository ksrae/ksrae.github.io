---
title: "PWA (Progressive Web App) 활용하기"
date: 2019-07-08 16:00:00 +0900
comments: true
categories: angular
tags: [pwa]
---



# Angular Progressive Web App

Service Worker를 활용하자.

[Angular Service Worker - Step-By-Step Guide](https://blog.angular-university.io/angular-service-worker/)

[Progressive Web Apps for Angular 6 and beyond – Angular Training](https://blog.angulartraining.com/progressive-web-apps-for-angular-6-and-beyond-f7e4b9a2f9fa)

1. 프로젝트 생성

```
ng new project-pwa
```

2. pwa 추가

```
ng add @angular/pwa --project [project-pwa]
```


3. 확인
- ngsw-config.json 파일 확인
- angular.json의 빌드 정보에 "serviceWorker": true 확인


4.  시작 모듈 확인

```ts
import { ServiceWorkerModule } from '@angular/service-worker';

@NgModule({
  declarations: [],
  imports: [
    ServiceWorkerModule.register('/ngsw-worker.js', { enabled: environment.production })
  ],
  providers: [],
  
})
export class AppModule { }
```


5.  시작 component에서 처리

```ts
import { Component, OnInit } from '@angular/core';
import { SwUpdate } from '@angular/service-worker';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent implements OnInit {
  updateMessage: string;

  constructor(
    private swUpdate: SwUpdate
  ) {

  }

  ngOnInit() {
    if ('serviceWorker' in navigator) {
      console.log('service worker!!!!!!!!!!!!!');
      
      if (this.swUpdate.isEnabled) {
        this.swUpdate.available.subscribe(() => {
          if (confirm('New version available. Load New Version?')) {
            window.location.reload();
          }
        });
      }
    }
    else {
      console.log('service worker is not ready');
    }
  }
}

```

6.  빌드

```
ng build --prod
```


7.  테스트
- http-server로 가상 서버나 실제 서버를 띄워 application 실행
- 빌드 코드 업로드
- 브라우저에서 테스트
- 코드 또는 캐시된 데이터를 수정하고 재빌드 후 업로드
- 브라우저 reload
- 몇 초 이내에 새 버전 업로드 확인 여부
- yes를 클릭하면 업데이트됨을 확인


8.  캐시 데이터 수정
ngsw-config.json의 external을 수정

```json
"external": {         
     "urls": [
             {"url": "https://fonts.googleapis.com/..."},
             {"url": "https://fonts.gstatic.com/s/..."}         
     ]     
}
````

9. 캐시 금지
ngsw-config.json에 내역을 추가

```json
{                 
   "name": "offline",
   "urls": { "https://mysite.com/data.json": {"match": "prefix"}},
   "cache": { 
               "optimizeFor": "freshness",
               "maxAgeMs": 360000000,                     
               "maxEntries": 1,                     
               "strategy": "lru"  
   }             
}
```

10. 캐시 구분
- app: html, css, js, ts, favicon등 어플리케이션에 포함되는 파일
- assets: assets 폴더의 파일이나 필요할 때만 로드되는 파일


11. mode 구분
- lazy: 필요할 때만 로드되는 파일의 모드는 lazy로 설정
- prefetch: 한번만 request한다. update는 prefeach로 설정하는 것이 좋다.




